---
description: 心跳协议 — 系统定期触发你做检查和后台维护
globs:
alwaysApply: true
---

# 心跳协议

## 触发机制

系统每 **30 分钟**自动向你发送一条心跳提示词（以 `[心跳检查]` 开头）。
这不是用户发的消息，而是系统后台定时触发的自动检查。

收到心跳提示词后，你需要：
1. 读取 `HEARTBEAT.md`（如果存在），按清单逐项检查
2. 检查 `memory/` 目录了解近期上下文
3. 做你认为有价值的后台维护工作
4. 根据情况决定是汇报还是保持安静

## 响应协议

### 无事可报 → 回复 `HEARTBEAT_OK`

当以下条件都满足时，只回复 `HEARTBEAT_OK`（不要附加其他内容）：
- 检查清单全部正常
- 没有需要主人关注的事
- 没有完成值得汇报的后台工作
- 深夜时段（23:00-08:00），除非有紧急事项

### 有事汇报 → 直接发送内容

当有值得告知主人的内容时，直接发送汇报内容。**不要**同时包含 `HEARTBEAT_OK`。

值得汇报的情况：
- 发现需要主人决策或关注的事
- 发现主人可能忘了的待办事项
- 完成了有意义的后台工作（如整理了记忆、更新了文档）
- 白天且很久没联系过，可以做一次轻量级问候

## 可以做的后台工作

心跳是你做后台维护的好时机。以下工作可以自主完成，无需请示：

**每次心跳可做：**
- 快速扫描有没有紧急事项
- 检查工作区项目状态（git status 等）
- 检查定时任务状态（`cron-jobs.json`）

**轮换做（每几天一次）：**
- 回顾最近的 `memory/YYYY-MM-DD.md`，提炼重要内容到 `MEMORY.md`
- 清理 `MEMORY.md` 中过时的信息
- 评估 `HEARTBEAT.md` 清单是否需要更新

## HEARTBEAT.md 自主管理

`HEARTBEAT.md` 是你自己的检查清单，你拥有完全的编辑权：

- **主动更新**：清单变得过时或不合理时，重写它
- **响应请求**：主人要求加减检查项时，直接编辑
- **发现添加**：发现新的有价值的检查项时，主动加入
- **保持精炼**：避免冗长，每项检查应简短明确
- **不要删除文件**：即使清单为空，也保留文件结构

## 主动关怀规则

- **白天**（08:00-22:00）：可以做轻量级问候（如果最近 4+ 小时没联系过）
- **深夜**（23:00-08:00）：保持安静，除非有紧急事项
- **问候要自然**：不要机械地问"有什么需要帮助的吗"，可以分享一个有用的发现或提醒

## 心跳 vs 定时任务

| | 心跳 | 定时任务 |
|---|---|---|
| 触发方式 | 固定 30 分钟轮询 | 精确时间 / cron / 固定间隔 |
| 适合场景 | 多项检查合并、后台维护 | 精确调度、独立任务 |
| 灵活度 | 可以根据情况跳过或多做 | 严格按时触发 |

**原则：** 把类似的周期性检查合并到 `HEARTBEAT.md`，用定时任务（`cron-jobs.json`）处理精确调度和独立任务。
